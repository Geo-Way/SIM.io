<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mantenimiento</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    const rolUsuario = localStorage.getItem("role") || "viewer";
    if (!localStorage.getItem("loggedIn")) {
      alert("Debes iniciar sesi√≥n para acceder.");
      window.location.href = "index.html";
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-900">
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between">
    <div class="flex items-center justify-between">
      <a href="index.html" class="flex items-center space-x-2">
        <img src="..." alt="Logo" class="h-10 w-auto" />
        <span class="text-xl font-bold text-red-600">SIMio</span>
        <span id="rolVisual" class="text-sm text-gray-500 italic ml-4">(Rol: <span id="nombreRol">...</span>)</span>
      </a>
      <button id="menuToggle" class="md:hidden text-gray-700 focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
    <nav class="hidden md:flex space-x-6 text-sm font-medium mt-2 md:mt-0">
      <a href="index.html" class="text-gray-700 hover:text-red-600">Home</a>
      <a href="inventario.html" class="text-gray-700 hover:text-red-600">Inventario</a>
      <a href="mantenimiento.html" class="text-red-600 hover:text-red-600 font-bold">Mantenimiento</a>
      <a href="maquinas.html" class="text-gray-700 hover:text-red-600">Diagrama de M√°quinas</a>
      <a href="info.html" title="Ver documentaci√≥n" class="text-gray-500 hover:text-red-600"> ‚ÑπÔ∏è </a>
    </nav>
    <div id="mobileMenu" class="md:hidden hidden flex flex-col space-y-2 mt-2">
      <a href="index.html" class="block py-2 text-gray-700 hover:text-red-600">Home</a>
      <a href="inventario.html" class="block py-2 text-gray-700 hover:text-red-600">Inventario</a>
      <a href="mantenimiento.html" class="block py-2 text-gray-700 hover:text-red-600">Mantenimiento</a>
      <a href="maquinas.html" class="block py-2 text-gray-700 hover:text-red-600">Diagrama de M√°quinas</a>
      <a href="info.html" class="block py-2 text-gray-700 hover:text-red-600">‚ÑπÔ∏è Info</a>
    </div>
  </div>
</header>
<main class="max-w-7xl mx-auto mt-10 p-4">
  <h2 class="text-lg font-semibold text-gray-700 mb-4">üìÑ Formulario de Mantenimiento</h2>
  <form id="formMantenimiento" enctype="multipart/form-data" class="grid md:grid-cols-3 gap-4 bg-white p-6 rounded shadow mb-6">
    <input class="p-2 border rounded" name="maquina" placeholder="M√°quina" required />
    <input class="p-2 border rounded" name="linea" placeholder="L√≠nea" />
    <input class="p-2 border rounded" name="fecha" type="date" />
    <input class="p-2 border rounded" name="tecnico" placeholder="T√©cnico" />
    <input class="p-2 border rounded" name="tiempo" type="number" placeholder="Horas mantenimiento" step="0.1" />
    <input class="p-2 border rounded" name="observaciones" placeholder="Observaciones" />
    <input type="hidden" name="id" id="idMantenimiento" />
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1" for="fotoman">Subir o Tomar Foto</label>
      <input class="p-2 border rounded w-full" type="file" name="fotoman" id="fotoman" accept="image/*" capture="environment" />
    </div>
    <select name="estadomotor" class="p-2 border rounded"><option value="">Motor</option><option>Operativo</option><option>Ruido Anormal</option><option>Vibraci√≥n</option><option>Sobrecalentamiento</option><option>Sin funcionamiento</option></select>
    <select name="transmision" class="p-2 border rounded"><option value="">Transmisi√≥n</option><option>Operativa</option><option>Desgaste</option><option>Desalineada</option><option>Falla</option></select>
    <select name="hidraulico" class="p-2 border rounded"><option value="">Hidr√°ulico</option><option>Sin fugas</option><option>Con fugas</option><option>Baja presi√≥n</option><option>Obstruido</option></select>
    <select name="neumatico" class="p-2 border rounded"><option value="">Neum√°tico</option><option>Correcto</option><option>Fuga de aire</option><option>P√©rdida de presi√≥n</option><option>Desgaste excesivo</option></select>
    <select name="electrico" class="p-2 border rounded"><option value="">El√©ctrico</option><option>Funciona bien</option><option>Corto circuito</option><option>Sensor fallando</option><option>Sin se√±al</option></select>
    <select name="estadoaccion" class="p-2 border rounded"><option value="">Estado Acci√≥n</option><option>Reparado</option><option>Pendiente</option><option>En seguimiento</option><option>Fuera de servicio</option></select>
    <fieldset class="col-span-full space-x-2">
      <legend class="font-semibold">S√≠ntomas Encontrados</legend>
      <label><input type="checkbox" name="sintomas" value="Ruido Anormal" /> Ruido Anormal</label>
      <label><input type="checkbox" name="sintomas" value="Fugas de L√≠quido" /> Fugas de L√≠quido</label>
      <label><input type="checkbox" name="sintomas" value="Olor a Quemado" /> Olor a Quemado</label>
      <label><input type="checkbox" name="sintomas" value="Corrosi√≥n" /> Corrosi√≥n</label>
      <label><input type="checkbox" name="sintomas" value="Vibraci√≥n Excesiva" /> Vibraci√≥n Excesiva</label>
      <label><input type="checkbox" name="sintomas" value="Sobrecalentamiento" /> Sobrecalentamiento</label>
      <label><input type="checkbox" name="sintomas" value="Humo" /> Humo</label>
      <label><input type="checkbox" name="sintomas" value="Desgaste Irregular" /> Desgaste Irregular</label>
    </fieldset>
    <button id="btnGuardar" class="col-span-full bg-red-600 text-white p-2 rounded hover:bg-red-700" type="submit">Guardar</button>
  </form>
  <hr class="my-10 border-t-2" />
  <h2 class="text-xl font-semibold text-gray-700 mb-4">üìã Filtrar mantenimientos</h2>
  <div class="bg-white p-4 rounded shadow mb-6">
    <div class="grid md:grid-cols-6 gap-4 mb-4">
      <input id="filtroMaquina" placeholder="M√°quina" class="p-2 border rounded" />
      <input id="filtroLinea" placeholder="L√≠nea" class="p-2 border rounded" />
      <input id="filtroTecnico" placeholder="T√©cnico" class="p-2 border rounded" />
      <input type="date" id="filtroFechaDesde" class="p-2 border rounded" />
      <input type="date" id="filtroFechaHasta" class="p-2 border rounded" />
      <select id="filtroEstado" class="p-2 border rounded">
        <option value="">Estado</option>
        <option>Reparado</option>
        <option>Pendiente</option>
        <option>En seguimiento</option>
        <option>Fuera de servicio</option>
      </select>
    </div>
    <div class="flex justify-end gap-2">
      <button onclick="aplicarFiltros()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded">Filtrar</button>
      <button onclick="limpiarFiltros()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-4 py-2 rounded">Limpiar</button>
    </div>
  </div>
  <h2 class="text-lg font-semibold text-gray-700 mb-2">Historial de Mantenimientos</h2>
  <div class="overflow-x-auto bg-white p-4 rounded shadow">
    <table class="min-w-full table-auto text-sm">
      <thead class="bg-gray-200">
        <tr>
          <th class="p-2">Fecha</th>
          <th class="p-2">M√°quina</th>
          <th class="p-2">L√≠nea</th>
          <th class="p-2">T√©cnico</th>
          <th class="p-2">Horas</th>
          <th class="p-2">Motor</th>
          <th class="p-2">Transmisi√≥n</th>
          <th class="p-2">Hidr√°ulico</th>
          <th class="p-2">Neum√°tico</th>
          <th class="p-2">El√©ctrico</th>
          <th class="p-2">S√≠ntomas</th>
          <th class="p-2">Observaciones</th>
          <th class="p-2">Acci√≥n</th>
          <th class="p-2">Foto</th>
          <th class="p-2">‚úèÔ∏è Editar</th>
          <th class="p-2">üóëÔ∏è Eliminar</th>
        </tr>
      </thead>
      <tbody id="tablaMantenimiento"></tbody>
    </table>
  </div>
  <div class="mt-4 flex gap-4">
    <button onclick="window.print()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded">Imprimir PDF</button>
    <button onclick="exportarCSV()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-4 py-2 rounded">Exportar CSV</button>
  </div>
</main>
<div id="modalFoto" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <img id="imagenGrande" class="max-h-[90vh] max-w-[90vw] border-4 border-white shadow-xl" />
</div>
<footer class="bg-gray-600 text-gray-200 text-center py-6 mt-10 text-sm">
  <div class="max-w-4xl mx-auto px-4 flex flex-col items-center space-y-2">
    <p>¬© 2025 <strong><a href="https://geo-way.github.io/GeoWay.io/index.html" class="hover:underline">GEOWAY</a></strong>, Technology-Based Initiative ‚Äì IBT. All rights reserved.</p>
    <img src="https://geo-way.github.io/GeoWay.io/images/Logo5.png" alt="GEOWAY Logo" class="h-8 md:h-6 w-auto" />
  </div>
</footer>
<script src="mantenimiento.js"></script>
</body>
</html>
