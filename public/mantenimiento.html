
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Mantenimiento</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const role = localStorage.getItem("role") || "admin";
      if (role === "viewer") {
        const form = document.getElementById("formMantenimiento");
        if (form) form.style.display = "none";
        window.viewerMode = true;
      } else {
        window.viewerMode = false;
      }
    });
  </script>
</head>
<body class="bg-gray-100 text-gray-900">
<main class="max-w-7xl mx-auto mt-10 p-4">
  <form id="formMantenimiento" enctype="multipart/form-data" class="grid md:grid-cols-3 gap-4 bg-white p-6 rounded shadow mb-6">
    <input class="p-2 border rounded" name="maquina" placeholder="Máquina" required/>
    <input class="p-2 border rounded" name="linea" placeholder="Línea"/>
    <input class="p-2 border rounded" name="fecha" type="date"/>
    <input class="p-2 border rounded" name="tecnico" placeholder="Técnico"/>
    <input class="p-2 border rounded" name="tiempo" type="number" placeholder="Horas" step="0.1"/>
    <input class="p-2 border rounded" name="observaciones" placeholder="Observaciones"/>
    <input type="file" class="p-2 border rounded" name="fotoman" accept="image/*"/>
    <button type="submit" class="col-span-full bg-red-600 text-white p-2 rounded hover:bg-red-700">Guardar</button>
  </form>

  <table class="min-w-full table-auto text-sm bg-white p-4 rounded shadow" id="tablaMantenimiento">
    <thead class="bg-gray-200">
      <tr>
        <th class="p-2">Fecha</th>
        <th class="p-2">Máquina</th>
        <th class="p-2">Técnico</th>
        <th class="p-2">Foto</th>
        <th class="p-2">✏️</th>
        <th class="p-2">🗑️</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script>
let datos = [
  {
    id: 1,
    fecha: "2025-04-14",
    maquina: "Cortadora",
    tecnico: "Carlos",
    fotoman: "https://via.placeholder.com/80"
  }
];

function renderTabla() {
  const tbody = document.querySelector("#tablaMantenimiento tbody");
  tbody.innerHTML = "";
  datos.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="p-2">${item.fecha}</td>
      <td class="p-2">${item.maquina}</td>
      <td class="p-2">${item.tecnico}</td>
      <td class="p-2"><img src="${item.fotoman}" class="h-16 w-auto rounded shadow" onclick="verFoto('${item.fotoman}')"/></td>
      <td class="p-2 text-center">
        <button class="btn-editar text-yellow-600 hover:scale-110 transition" onclick="editar(${item.id})">✏️</button>
      </td>
      <td class="p-2 text-center">
        <button class="btn-borrar text-red-600 hover:scale-110 transition" onclick="eliminar(${item.id})">🗑️</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  if (window.viewerMode) {
    document.querySelectorAll(".btn-editar, .btn-borrar").forEach(btn => {
      btn.disabled = true;
      btn.classList.add("opacity-50", "cursor-not-allowed");
      btn.title = "Acceso restringido";
    });
  }
}

function verFoto(url) {
  window.open(url, "_blank");
}

function editar(id) {
  alert("Editar id " + id);
}
function eliminar(id) {
  if (confirm("Eliminar id " + id)) {
    datos = datos.filter(d => d.id !== id);
    renderTabla();
  }
}

document.addEventListener("DOMContentLoaded", renderTabla);
</script>
</body>
</html>
