<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagrama de Máquinas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    .radar-ring {
      animation: pulse 2s infinite;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      position: absolute;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.6; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }
  </style>
</head>
<body class="bg-gray-100">
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center space-x-2">
        <img src="https://images.squarespace-cdn.com/content/v1/58a36221d482e9bca4af6eac/34694fc3-6f92-4054-8a58-3776436c00dc/IMG_9869+2.PNG?format=2500w" alt="Logo" class="h-10 w-auto" />
        <span class="text-xl font-bold text-red-600">SIMio</span>
      </a>
      <nav class="hidden md:flex space-x-6 text-sm font-medium">
        <a href="index.html" class="text-gray-700 hover:text-red-600">Home</a>
        <a href="inventario.html" class="text-gray-700 hover:text-red-600">Inventario</a>
        <a href="mantenimiento.html" class="text-gray-700 hover:text-red-600">Mantenimiento</a>
        <a href="maquinas.html" class="text-red-600 font-bold">Diagrama de Máquinas</a>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto mt-10 px-4">
    <h1 class="text-xl font-bold mb-4">📍 Diagrama de Máquinas</h1>
    <div id="map" class="w-full h-[80vh] rounded shadow relative"></div>
    <div class="mt-4 p-4 bg-white rounded shadow inline-block text-sm">
      <p class="font-semibold mb-1">🟢 Reparado</p>
      <p class="font-semibold mb-1">🟡 Pendiente</p>
      <p class="font-semibold mb-1">🟠 En seguimiento</p>
      <p class="font-semibold mb-1">🔴 Fuera de servicio</p>
    </div>
  </main>

  <footer class="bg-gray-600 text-gray-200 text-center py-6 mt-10 text-sm">
    <div class="max-w-4xl mx-auto px-4 flex flex-col items-center space-y-2">
      <p>
        © 2025 <strong>GEOWAY</strong>, Technology-Based Initiative – IBT. All rights reserved.
      </p>
      <a href="https://geo-way.github.io/GeoWay.io/index.html" target="_blank" class="hover:opacity-80 transition-opacity">
        <img src="https://geo-way.github.io/GeoWay.io/images/Logo5.png" alt="GEOWAY Logo" class="h-8 invert">
      </a>
    </div>
  </footer>

  <script>
    const estados = {
      "Reparado": "#16a34a",
      "Pendiente": "#facc15",
      "En seguimiento": "#fb923c",
      "Fuera de servicio": "#dc2626"
    };

    const maquinas = [
      { nombre: "PISTOLA CUADROS", coords: [892, 206], estadoaccion: "Reparado" },
      { nombre: "PISTOLA SEMIFLEX", coords: [822, 206], estadoaccion: "Pendiente" },
      { nombre: "PISTOLA CERRAR", coords: [750, 206], estadoaccion: "En seguimiento" },
      { nombre: "EMBALADORA 2 TK381", coords: [120, 390], estadoaccion: "Fuera de servicio" },
      { nombre: "PORTER", coords: [770, 575], estadoaccion: "Reparado" },
      { nombre: "CORTE BOBINAS", coords: [900, 655], estadoaccion: "Pendiente" },
      { nombre: "ZONA POKCKET LR-PS-LINE 19F09", coords: [380, 1120], estadoaccion: "En seguimiento" },
      { nombre: "ZONA BONNEL", coords: [380, 1250], estadoaccion: "Reparado" },
      { nombre: "ENCOLADORA 1", coords: [510, 645], estadoaccion: "Pendiente" },
      { nombre: "ENCOLADORA 2", coords: [510, 810], estadoaccion: "Fuera de servicio" },
      // ... Agrega el resto aquí como desees
    ];

    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,
      maxZoom: 2,
      zoomControl: false
    });

    const bounds = [[0, 0], [1000, 1500]];
    const image = L.imageOverlay('img/layout_horizontal.png', bounds).addTo(map);
    map.setView([600, 750], 0);

    maquinas.forEach(({ nombre, coords, estadoaccion }) => {
      const color = estados[estadoaccion] || '#6b7280';

      const marker = L.circleMarker(coords, {
        radius: 8,
        color,
        fillColor: color,
        fillOpacity: 1
      }).addTo(map);

      const urlManual = manualUrl(nombre);
      const urlMantenimiento = `mantenimiento.html?maquina=${encodeURIComponent(nombre)}`;

      marker.bindPopup(`
        <div class="text-sm">
          <p class="font-bold">🔧 ${nombre}</p>
          <p>Estado: <span class="font-medium" style="color: ${color}">${estadoaccion}</span></p>
          <a href="${urlManual}" target="_blank" class="text-blue-600 underline block mt-1">📥 Descargar manual</a>
          <a href="${urlMantenimiento}" class="text-blue-600 underline block">🔧 Ver mantenimientos</a>
        </div>
      `);

      const radar = L.divIcon({
        className: 'radar-icon',
        html: `<div class="radar-ring" style="background-color:${color};"></div>`
      });
      L.marker(coords, { icon: radar }).addTo(map);
    });

    function manualUrl(nombre) {
      const fileName = nombre.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '') + ".pdf";
      // Aquí puedes personalizar la URL para cada máquina si lo deseas
      const overrides = {
        "ENCOLADORA_1": "https://kalixxe.github.io/Manuales/encoladora1_especial.pdf",
        "PORTER": "https://kalixxe.github.io/Manuales/manual_porter_v2.pdf"
      };
      return overrides[fileName] || `https://kalixxe.github.io/Manuales/${fileName}`;
    }
  </script>
</body>
</html>
